# 数据结构说明

## 数据组织

### 原始图像 (RAW/)
- 200张原始人脸图像
- 命名: 1.jpg, 2.jpg, ..., 200.jpg

### 生成图像 (All/)
- 1600张生成的人脸图像
- 每张原始图像对应8张生成图像
- 命名规则:
  ```
  RAW/1.jpg   → All/1.jpg, All/2.jpg, ..., All/8.jpg
  RAW/2.jpg   → All/9.jpg, All/10.jpg, ..., All/16.jpg
  RAW/3.jpg   → All/17.jpg, All/18.jpg, ..., All/24.jpg
  ...
  RAW/200.jpg → All/1593.jpg, All/1594.jpg, ..., All/1600.jpg
  ```

### 标注文件 (BT-Scores.xlsx)
- 包含1600张生成图像的评分
- 列结构:
  - `图像ID`: 1-1600 (对应All/中的图像)
  - `质量维度分数`: 整体图像质量评分
  - `人脸一致性维度分数`: ID保真度评分

## 数据划分策略

### 重要: 按原始图像ID划分

为了避免数据泄露，我们**按原始图像ID进行划分**，而不是随机划分生成图像。

**原因:**
- 同一张原始图像的8张生成图像可能具有相似的特征
- 如果训练集和测试集包含同一原始图像的不同生成版本，会导致过于乐观的评估结果
- 按原始图像ID划分可以更准确地评估模型的泛化能力

**划分方式:**
```
200张原始图像 → 划分为训练/验证/测试集
  ↓
训练集: 140张原始图像 → 1120张生成图像 (70%)
验证集: 30张原始图像  → 240张生成图像  (15%)
测试集: 30张原始图像  → 240张生成图像  (15%)
```

## 原始图像ID计算

给定生成图像ID (1-1600)，计算对应的原始图像ID:

```python
raw_id = (img_id - 1) // 8 + 1
```

示例:
- img_id = 1-8   → raw_id = 1
- img_id = 9-16  → raw_id = 2
- img_id = 17-24 → raw_id = 3
- ...
- img_id = 1593-1600 → raw_id = 200

## 代码实现

数据加载和划分已在 `data/preprocess.py` 中实现:

```python
# 加载数据
image_paths, scores, raw_ids = load_data(score_file, all_dir, task='quality')

# 按原始图像ID划分
train_paths, train_scores, val_paths, val_scores, test_paths, test_scores = split_data(
    image_paths, scores, raw_ids,
    train_ratio=0.7, val_ratio=0.15, test_ratio=0.15
)
```
